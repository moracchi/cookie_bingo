/* 基本設定 */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

:root {
    --xmas-red: #d62828;

    .disco-layer {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 1;
        /* 背景より手前、雪より奥 */
        opacity: 0;
        transition: opacity 0.5s ease;
        mix-blend-mode: hard-light;
    }

    /* 回転中はこのレイヤーを表示 */
    body.is-spinning .disco-layer {
        opacity: 1;
    }

    /* 回転中は背景全体を暗くする */
    body.is-spinning {
        background-image: radial-gradient(circle at center, #4a0000 0%, #000000 100%);
    }

    .spotlight {
        position: absolute;
        top: 50%;
        left: 50%;
        width: 150vmax;
        height: 150vmax;
        transform-origin: center;
        transform: translate(-50%, -50%);
        background: conic-gradient(from 0deg,
                transparent 0deg,
                rgba(255, 255, 255, 0.0) 20deg,
                rgba(255, 215, 0, 0.3) 40deg,
                /* Gold */
                rgba(255, 255, 255, 0.0) 60deg);
        animation: rotateSpotlight 4s linear infinite;
    }

    .spot-1 {
        animation-duration: 5s;
        animation-direction: normal;
    }

    .spot-2 {
        animation-duration: 7s;
        animation-direction: reverse;
        background: conic-gradient(from 120deg, transparent 0deg, rgba(0, 255, 0, 0.2) 30deg, transparent 60deg);
    }

    .spot-3 {
        animation-duration: 9s;
        animation-direction: normal;
        background: conic-gradient(from 240deg, transparent 0deg, rgba(0, 255, 255, 0.2) 30deg, transparent 60deg);
    }

    @keyframes rotateSpotlight {
        0% {
            transform: translate(-50%, -50%) rotate(0deg);
        }

        100% {
            transform: translate(-50%, -50%) rotate(360deg);
        }
    }

    /* 雪の結晶アニメーション（JS生成用） */
    .snowflakes {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 5;
    }

    .snowflake {
        position: absolute;
        top: -20px;
        color: rgba(255, 255, 255, 0.95);
        text-shadow: 0 0 5px rgba(255, 255, 255, 0.8);
        will-change: transform;
    }

    .snowflake.large {
        font-size: 2.5em;
        z-index: 6;
        opacity: 0.95;
    }

    .snowflake.medium {
        font-size: 1.5em;
        z-index: 5;
        opacity: 0.8;
    }

    .snowflake.small {
        font-size: 0.8em;
        z-index: 4;
        opacity: 0.6;
    }

    @keyframes snowfall {
        0% {
            transform: translateY(-20px) translateX(0) rotate(0deg);
        }

        100% {
            transform: translateY(110vh) translateX(20px) rotate(360deg);
        }
    }

    /* 当選時のサンバースト */
    .win-effect-layer {
        position: fixed;
        top: 50%;
        left: 50%;
        width: 200vmax;
        height: 200vmax;
        transform: translate(-50%, -50%) scale(0);
        z-index: 2;
        pointer-events: none;
        opacity: 0;
    }

    .win-effect-active {
        animation: winExpand 4s ease-out forwards;
        background: repeating-conic-gradient(from 0deg, #ffeb3b 0deg 20deg, #ff9800 20deg 40deg);
        opacity: 1;
    }

    @keyframes winExpand {
        0% {
            transform: translate(-50%, -50%) scale(0) rotate(0deg);
            opacity: 0;
        }

        10% {
            transform: translate(-50%, -50%) scale(1) rotate(20deg);
            opacity: 1;
        }

        80% {
            transform: translate(-50%, -50%) scale(1) rotate(120deg);
            opacity: 1;
        }

        100% {
            transform: translate(-50%, -50%) scale(1.2) rotate(140deg);
            opacity: 0;
        }
    }

    /* =========================================
   メインレイアウト
   ========================================= */
    .container {
        width: 100%;
        height: 100%;
        position: relative;
        z-index: 10;
        display: flex;
        display: flex;
        justify-content: center;
        align-items: center;
        position: relative;
        width: 100%;
        height: 100%;
    }

    .lottery-stage {
        position: relative;
        /* 画面の短い方の辺に合わせて大きく表示（余白を少し残す） */
        width: min(75vw, 75vh);
        height: min(75vw, 75vh);
        background: radial-gradient(circle at 50% 50%, #ffffff 0%, #e0f7fa 100%);
        border-radius: 50%;
        box-shadow:
            0 0 0 15px var(--xmas-gold),
            0 0 0 30px var(--xmas-green),
            0 30px 60px rgba(0, 0, 0, 0.5),
            inset 0 10px 20px rgba(255, 255, 255, 1);
        display: flex;
        justify-content: center;
        align-items: center;
        overflow: hidden;
        transition: transform 0.3s ease;
    }

    /* 回転中は少し浮き上がる */
    body.is-spinning .lottery-stage {
        transform: scale(1.05);
        box-shadow:
            0 0 0 15px var(--xmas-gold),
            0 0 0 30px var(--xmas-green),
            0 0 100px rgba(255, 215, 0, 0.8),
            /* 光る */
            inset 0 10px 20px rgba(255, 255, 255, 1);
    }

    .shine-effect {
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: linear-gradient(45deg, transparent 40%, rgba(255, 255, 255, 0.8) 50%, transparent 60%);
        animation: shineRotate 6s linear infinite;
        pointer-events: none;
        z-index: 1;
        opacity: 0.4;
    }

    @keyframes shineRotate {
        0% {
            transform: rotate(0deg);
        }

        100% {
            transform: rotate(360deg);
        }
    }

    .animation-container {
        width: 100%;
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 10;
    }

    .number-display {
        width: 85%;
        height: 85%;
        display: flex;
        justify-content: center;
        align-items: center;
        position: relative;
        z-index: 10;
    }

    .question-mark {
        font-size: clamp(100px, 25vh, 250px);
        color: var(--xmas-red);
        font-weight: 900;
        text-shadow: 5px 5px 0 rgba(0, 0, 0, 0.1);
        animation: bounceQuestion 1.5s infinite alternate;
    }

    @keyframes bounceQuestion {
        0% {
            transform: scale(1) rotate(-5deg);
        }

        100% {
            transform: scale(1.1) rotate(5deg);
        }
    }

    /* 履歴エリア (右下にサブ的に配置) */
    .history-container {
        position: absolute;
        bottom: 20px;
        right: 20px;
        background: rgba(255, 255, 255, 0.9);
        padding: 10px;
        border-radius: 15px;
        border: 3px solid var(--xmas-green);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        width: 220px;
        /* 固定幅でコンパクトに */
        max-height: 30vh;
        /* 高くなりすぎないように */
        display: flex;
        flex-direction: column;
        transform: rotate(-2deg);
        /* スタンプ/シールっぽく少し傾ける */
        z-index: 30;
    }

    /* モバイル対応: 画面が狭いときは下部中央に */
    @media (max-width: 768px) {
        .history-container {
            right: 50%;
            transform: translateX(50%);
            bottom: 10px;
            width: 90%;
            flex-direction: row;
            align-items: center;
            height: 60px;
            overflow-x: auto;
            overflow-y: hidden;
        }

        .history-label {
            writing-mode: horizontal-tb;
            margin-right: 10px;
            border-bottom: none;
            border-right: 2px dotted var(--xmas-gold);
            padding-bottom: 0;
            padding-right: 5px;
        }

        .lottery-stage {
            width: min(80vw, 50vh);
            height: min(80vw, 50vh);
        }
    }

    .history-label {
        color: var(--xmas-dark-red);
        font-size: 0.8rem;
        font-weight: 900;
        text-align: center;
        border-bottom: 2px dotted var(--xmas-gold);
        padding-bottom: 5px;
        margin-bottom: 5px;
        letter-spacing: 0.1em;
    }

    .number-history {
        flex: 1;
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 8px;
        overflow-y: auto;
        /* 溢れたらスクロール */
        align-content: flex-start;
    }

    .history-number {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: var(--xmas-white);
        border: 2px solid var(--xmas-gold);
        box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.2);
        display: flex;
        justify-content: center;
        align-items: center;
        animation: ornamentSway 3s ease-in-out infinite;
        flex-shrink: 0;
    }

    .history-number:nth-child(odd) {
        animation-duration: 3.5s;
        animation-delay: 0.5s;
    }

    @keyframes ornamentSway {
        0% {
            transform: rotate(-5deg);
        }

        50% {
            transform: rotate(5deg);
        }

        100% {
            transform: rotate(-5deg);
        }
    }

    .history-number img {
        width: 85% !important;
        height: 85% !important;
        border-radius: 50%;
        object-fit: contain;
    }

    .number-history::-webkit-scrollbar {
        width: 4px;
    }

    .number-history::-webkit-scrollbar-thumb {
        background: var(--xmas-green);
        border-radius: 2px;
    }


    /* ------------------------------
   アニメーション定義 (既存維持)
   ------------------------------ */
    .fall-animation {
        animation: fallDownPop 5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    @keyframes fallDownPop {
        0% {
            transform: translateY(-600px) rotate(0deg);
            opacity: 0;
        }

        30% {
            transform: translateY(0) rotate(360deg);
            opacity: 1;
        }

        40% {
            transform: scale(1.3) rotate(360deg);
        }

        50% {
            transform: scale(0.9) rotate(360deg);
        }

        60% {
            transform: scale(1.1) rotate(360deg);
        }

        100% {
            transform: scale(1) rotate(360deg);
        }
    }

    .slide-animation {
        animation: slidePop 5s ease-in-out;
    }

    @keyframes slidePop {
        0% {
            transform: translateX(100vw) rotate(0deg);
        }

        20% {
            transform: translateX(-20px) rotate(-720deg);
        }

        30% {
            transform: translateX(10px) rotate(-720deg);
        }

        100% {
            transform: translateX(0) rotate(-720deg);
        }
    }

    .slot-animation {
        animation: popScale 5s ease-in-out;
    }

    @keyframes popScale {
        0% {
            transform: scale(0);
        }

        20% {
            transform: scale(1.5);
        }

        40% {
            transform: scale(0.8);
        }

        60% {
            transform: scale(1.2);
        }

        80% {
            transform: scale(0.9);
        }

        100% {
            transform: scale(1);
        }
    }

    .explosion-animation {
        animation: shakePop 5s linear;
    }

    @keyframes shakePop {

        0%,
        90% {
            transform: translate3d(-1px, 0, 0);
        }

        20%,
        80% {
            transform: translate3d(2px, 0, 0);
        }

        30%,
        50%,
        70% {
            transform: translate3d(-4px, 0, 0);
        }

        40%,
        60% {
            transform: translate3d(4px, 0, 0);
        }

        95% {
            transform: scale(1.5);
        }

        100% {
            transform: scale(1);
        }
    }

    .golden-animation {
        animation: spinGold 5s linear;
        filter: drop-shadow(0 0 15px gold);
    }

    @keyframes spinGold {
        0% {
            transform: rotateY(0);
        }

        100% {
            transform: rotateY(1800deg);
        }
    }

    .rainbow-animation {
        animation: rainbowPop 5s linear;
    }

    @keyframes rainbowPop {
        0% {
            filter: hue-rotate(0deg);
            transform: scale(0.5);
        }

        50% {
            filter: hue-rotate(180deg);
            transform: scale(1.2);
        }

        100% {
            filter: hue-rotate(360deg);
            transform: scale(1);
        }
    }

    .bounce-animation {
        animation: bouncePop 5s infinite;
    }

    @keyframes bouncePop {

        0%,
        100% {
            transform: translateY(0);
        }

        50% {
            transform: translateY(-30px);
        }
    }

    .lightning-animation {
        animation: flashPop 5s steps(5, start);
    }

    @keyframes flashPop {
        0% {
            opacity: 1;
        }

        50% {
            opacity: 0;
        }

        100% {
            opacity: 1;
        }
    }

    .blink-animation {
        animation: heartbeat 1.5s ease-in-out infinite both;
    }

    @keyframes heartbeat {
        from {
            transform: scale(1);
        }

        10% {
            transform: scale(0.91);
        }

        17% {
            transform: scale(0.98);
        }

        33% {
            transform: scale(0.87);
        }

        45% {
            transform: scale(1);
        }
    }

    /* 結果メッセージ */
    .result-message {
        position: absolute;
        bottom: 5%;
        left: 50%;
        transform: translateX(-50%);
        font-size: clamp(1.2rem, 3vw, 2.5rem);
        color: var(--xmas-white);
        font-weight: 900;
        text-shadow: 2px 2px 0 var(--xmas-red), -2px -2px 0 var(--xmas-red), 2px -2px 0 var(--xmas-red), -2px 2px 0 var(--xmas-red);
        background: rgba(0, 0, 0, 0.6);
        padding: 10px 20px;
        border-radius: 20px;
        border: 2px solid var(--xmas-gold);
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.5s ease, transform 0.5s ease;
        z-index: 100;
        white-space: nowrap;
    }

    .result-message.show {
        opacity: 1;
        transform: translateX(-50%) translateY(-10px);
        animation: bounceMessage 1s infinite alternate;
    }

    @keyframes bounceMessage {
        0% {
            transform: translateX(-50%) translateY(-10px);
        }

        100% {
            transform: translateX(-50%) translateY(-20px);
        }
    }